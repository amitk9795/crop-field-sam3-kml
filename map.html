<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Crop Field SAM3 KML Mapper</title><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-draw/1.0.4/leaflet.draw.min.css"/><style>*{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;font-family:Arial,sans-serif}#map{width:100%;height:calc(100vh - 130px)}#ctrl{background:#2c3e50;color:#fff;padding:15px;position:fixed;top:0;width:100%;z-index:1000;box-shadow:0 2px 8px rgba(0,0,0,0.3)}#ctrl h1{font-size:20px;margin-bottom:8px}button{padding:8px 12px;margin:3px;border:0;border-radius:3px;cursor:pointer;font-weight:bold;color:#fff;transition:0.3s}.bg-green{background:#27ae60}.bg-green:hover{background:#229954}.bg-blue{background:#3498db}.bg-blue:hover{background:#2980b9}.bg-red{background:#e74c3c}.bg-red:hover{background:#c0392b}.btn-toggle{background:#34495e;padding:6px 10px;font-size:12px;margin-left:10px}.btn-toggle.active{background:#27ae60}#stats{color:#ecf0f1;font-size:12px;margin-top:8px;background:rgba(0,0,0,0.3);padding:8px;border-radius:3px;display:inline-block}#layerToggle{display:inline-block;margin-left:20px}</style></head><body><div id="ctrl"><h1>üåæ Crop Field Delineation - Google Maps View</h1><div><button class="bg-green" onclick="downloadKML()">üì• Download KML</button><button class="bg-blue" onclick="loadSample()">üìç Load Sample</button><button class="bg-red" onclick="clearAll()">üóëÔ∏è Clear All</button><div id="layerToggle"><button class="btn-toggle active" onclick="switchLayer('satellite')">Satellite</button><button class="btn-toggle" onclick="switchLayer('roadmap')">Roadmap</button><button class="btn-toggle" onclick="switchLayer('terrain')">Terrain</button></div></div><div id="stats">Fields: <span id="fc">0</span> | Area: <span id="ta">0</span> m¬≤ | Map: <span id="lyr">Google Satellite</span></div></div><div id="map"></div><script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-draw/1.0.4/leaflet.draw.min.js"></script><script>let map=L.map('map').setView([25,82.5],6);let drawnItems=new L.FeatureGroup();map.addLayer(drawnItems);let baseLayers={};let currentLayer='satellite';baseLayers.satellite=L.tileLayer('https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}',{attribution:'<a href="https://leafletjs.com">Leaflet</a> | Map data ¬© Google',maxZoom:20});baseLayers.roadmap=L.tileLayer('https://mt1.google.com/vt/lyrs=m&x={x}&y={y}&z={z}',{attribution:'<a href="https://leafletjs.com">Leaflet</a> | Map data ¬© Google',maxZoom:20});baseLayers.terrain=L.tileLayer('https://mt1.google.com/vt/lyrs=p&x={x}&y={y}&z={z}',{attribution:'<a href="https://leafletjs.com">Leaflet</a> | Map data ¬© Google',maxZoom:20});baseLayers.satellite.addTo(map);let drawControl=new L.Control.Draw({edit:{featureGroup:drawnItems},draw:{polygon:true,polyline:false,rectangle:false,circle:false,marker:false,circlemarker:false}});map.addControl(drawControl);map.on('draw:created draw:edited draw:deleted',updateStats);function updateStats(){let f=drawnItems.toGeoJSON().features;let a=0;f.forEach(x=>{if(x.geometry&&x.geometry.type==='Polygon'){a+=calcArea(x.geometry.coordinates[0])}});document.getElementById('fc').textContent=f.length;document.getElementById('ta').textContent=Math.round(a)}function calcArea(c){let a=0;for(let i=0;i<c.length-1;i++){a+=(c[i+1][0]-c[i][0])*(c[i+1][1]+c[i][1])}return Math.abs(a/2)*111000*111000}function downloadKML(){let g=drawnItems.toGeoJSON();if(!g.features.length){alert('No fields drawn!');return}let k='<?xml version="1.0"?><kml xmlns="http://www.opengis.net/kml/2.2"><Document><name>Fields</name>';g.features.forEach((f,i)=>{if(f.geometry.type==='Polygon'){let c=f.geometry.coordinates[0].map(p=>p[0]+','+p[1]+',0').join(' ');k+='<Placemark><name>Field '+(i+1)+'</name><Polygon><outerBoundaryIs><LinearRing><coordinates>'+c+'</coordinates></LinearRing></outerBoundaryIs></Polygon></Placemark>'}});k+='</Document></kml>';let b=new Blob([k],{type:'application/vnd.google-earth.kml+xml'});let u=URL.createObjectURL(b);let a=document.createElement('a');a.href=u;a.download='fields_'+new Date().toISOString().slice(0,10)+'.kml';a.click();URL.revokeObjectURL(u);alert('KML exported!')}function loadSample(){let s={type:'FeatureCollection',features:[{type:'Feature',geometry:{type:'Polygon',coordinates:[[[82.5,25],[82.6,25],[82.6,25.1],[82.5,25.1],[82.5,25]]]},properties:{name:'Sample Field 1'}},{type:'Feature',geometry:{type:'Polygon',coordinates:[[[82.3,25.2],[82.4,25.2],[82.4,25.3],[82.3,25.3],[82.3,25.2]]]},properties:{name:'Sample Field 2'}}]};s.features.forEach(f=>{L.geoJSON(f,{style:{color:'yellow',weight:3,opacity:0.9},onEachFeature:(feature,layer)=>{drawnItems.addLayer(layer)}})});updateStats()}function clearAll(){if(confirm('Clear all fields?')){drawnItems.clearLayers();updateStats()}}function switchLayer(name){if(currentLayer!==name){map.removeLayer(baseLayers[currentLayer]);baseLayers[name].addTo(map);currentLayer=name;let labels={'satellite':'Google Satellite','roadmap':'Google Roadmap','terrain':'Google Terrain'};document.getElementById('lyr').textContent=labels[name];document.querySelectorAll('.btn-toggle').forEach(b=>b.classList.remove('active'));event.target.classList.add('active')}}</script></body></html>
