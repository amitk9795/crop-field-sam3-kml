map.html<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Crop Field SAM3 KML Mapper</title><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-draw/1.0.4/leaflet.draw.min.css"/><style>*{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;font-family:Arial,sans-serif}#map{width:100%;height:calc(100vh - 130px)}#ctrl{background:#333;color:#fff;padding:15px;position:fixed;top:0;width:100%;z-index:1000}#ctrl h1{font-size:20px;margin-bottom:8px}button{padding:8px 12px;margin:3px;border:0;border-radius:3px;cursor:pointer;font-weight:bold;color:#fff}.bg-green{background:#4CAF50}.bg-green:hover{background:#45a049}.bg-blue{background:#2196F3}.bg-blue:hover{background:#0b7dda}.bg-red{background:#f44336}.bg-red:hover{background:#da190b}#stats{color:#fff;font-size:12px;margin-top:8px}</style></head><body><div id="ctrl"><h1>ğŸŒ¾ Crop Field Delineation</h1><button class="bg-green" onclick="downloadKML()">ğŸ“¥ Download KML</button><button class="bg-blue" onclick="loadSample()">ğŸ“ Load Sample</button><button class="bg-red" onclick="clearAll()">ğŸ—‘ï¸ Clear All</button><div id="stats">Fields: 0 | Area: 0 mÂ²</div></div><div id="map"></div><script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-draw/1.0.4/leaflet.draw.min.js"></script><script>let map=L.map('map').setView([25,82.5],6);let drawnItems=new L.FeatureGroup();map.addLayer(drawnItems);L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; OpenStreetMap',maxZoom:19}).addTo(map);L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',{attribution:'Esri',maxZoom:18,opacity:0.65}).addTo(map);let drawControl=new L.Control.Draw({edit:{featureGroup:drawnItems},draw:{polygon:true,polyline:false,rectangle:false,circle:false,marker:false,circlemarker:false}});map.addControl(drawControl);map.on('draw:created draw:edited draw:deleted',updateStats);function updateStats(){let f=drawnItems.toGeoJSON().features;let a=0;f.forEach(x=>{if(x.geometry&&x.geometry.type==='Polygon'){a+=calcArea(x.geometry.coordinates[0])}});document.getElementById('stats').innerHTML='Fields: '+f.length+' | Area: '+Math.round(a)+' mÂ²'}function calcArea(c){let a=0;for(let i=0;i<c.length-1;i++){a+=(c[i+1][0]-c[i][0])*(c[i+1][1]+c[i][1])}return Math.abs(a/2)*111000*111000}function downloadKML(){let g=drawnItems.toGeoJSON();if(!g.features.length){alert('No fields drawn!');return}let k='<?xml version="1.0"?><kml xmlns="http://www.opengis.net/kml/2.2"><Document><name>Fields</name>';g.features.forEach((f,i)=>{if(f.geometry.type==='Polygon'){let c=f.geometry.coordinates[0].map(p=>p[0]+','+p[1]+',0').join(' ');k+='<Placemark><name>Field '+(i+1)+'</name><Polygon><outerBoundaryIs><LinearRing><coordinates>'+c+'</coordinates></LinearRing></outerBoundaryIs></Polygon></Placemark>'}});k+='</Document></kml>';let b=new Blob([k],{type:'application/vnd.google-earth.kml+xml'});let u=URL.createObjectURL(b);let a=document.createElement('a');a.href=u;a.download='fields_'+new Date().toISOString().slice(0,10)+'.kml';a.click();URL.revokeObjectURL(u);alert('KML downloaded!')}function loadSample(){let s={type:'FeatureCollection',features:[{type:'Feature',geometry:{type:'Polygon',coordinates:[[[82.5,25],[82.6,25],[82.6,25.1],[82.5,25.1],[82.5,25]]]},properties:{name:'Sample Field 1'}},{type:'Feature',geometry:{type:'Polygon',coordinates:[[[82.3,25.2],[82.4,25.2],[82.4,25.3],[82.3,25.3],[82.3,25.2]]]},properties:{name:'Sample Field 2'}}]};s.features.forEach(f=>{L.geoJSON(f,{style:{color:'yellow',weight:2,opacity:0.8},onEachFeature:(feature,layer)=>{drawnItems.addLayer(layer)}})});updateStats()}function clearAll(){if(confirm('Clear all?')){drawnItems.clearLayers();updateStats()}}console.log('App loaded');</script></body></html>
